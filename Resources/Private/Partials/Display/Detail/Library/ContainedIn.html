{namespace v=FluidTYPO3\vhs\ViewHelpers}
{namespace slub=Slub\SlubFindExtend\ViewHelpers}
{namespace dla=Dla\DlaOpacNg\ViewHelpers}
{namespace s=Subugoe\Find\ViewHelpers}

<f:comment>Enthalten in</f:comment>

<v:variable.set value="{0:'Einzelbestandteil / unselbständiges Werk'}" name="AKA451_Filter" />

<f:comment>
<v:variable.set value="{0:'Teil einer fortlaufenden Zusammenstellung, Aufsatz (z.B. Zeitschrift)'}" name="AKA451_Filter" />
</f:comment>

<dla:data.valueForKeyFiltered key="GESTYP" filterKey="GESTYP" negateFilter="true" filterValues="{AKA451_Filter}" fields="{document.fields}" as="GESTYP" />

<dla:data.valueForKeyFiltered key="XX_AK_TITREG_AKA451" filterKey="GESTYP" negateFilter="false"  filterValues="{AKA451_Filter}" fields="{document.fields}" as="XX_AK_TITREG_AKA451" />
<dla:data.valueForKeyFiltered key="AKA451" filterKey="GESTYP" negateFilter="false"  filterValues="{AKA451_Filter}" fields="{document.fields}" as="AKA451" />
<dla:data.valueForKeyFiltered key="USEIT" filterKey="GESTYP" negateFilter="true"  filterValues="{AKA451_Filter}" fields="{document.fields}" as="USEIT" />
<dla:data.valueForKeyFiltered key="listview_additional1" filterKey="GESTYP" negateFilter="true"  filterValues="{AKA451_Filter}" fields="{document.fields}" as="listview_additional1" />
<dla:data.valueForKeyFiltered key="XX_AK_A0359_AKA451" filterKey="GESTYP" negateFilter="true"  filterValues="{AKA451_Filter}" fields="{document.fields}" as="XX_AK_A0359_AKA451" />


<f:if condition="{GESTYP.0} == 'Teil einer fortlaufenden Zusammenstellung, Aufsatz (z.B. Zeitschrift)' ||
                 {GESTYP.0} == 'Begleitmaterial / Beilage'">
    <f:then>
        <dla:data.joinFieldArrays
            arrays="{0:'{listview_additional1}'}"
            fieldWraps="{0:'%s'}"
            as="linkTexts"
        />
    </f:then>
    <f:else if="{GESTYP.0} == 'Teil einer monografischen Zusammenstellung, unselbständiges Stück'">
        <dla:data.joinFieldArrays
                arrays="{0:'{XX_AK_TITREG_AKA451}',1:'{XX_AK_A0359_AKA451}',2:'{listview_additional1}', 3:'{USEIT}'}"
                fieldWraps="{0:'%s',1:'\ %s', 2:'%s . - ', 3:'; %s'}"
                as="linkTexts"
        />
    </f:else>
    <f:else>
        <dla:data.joinFieldArrays
            arrays="{0:'{XX_AK_TITREG_AKA451}',1:'{USEIT}'}"
            fieldWraps="{0:'%s',1:': %s'}"
            as="linkTexts"
        />
    </f:else>
</f:if>

<div class="ctg-dtvt-label">
    Enthalten in
</div>
<div class="ctg-dtvt-content">
    <f:if condition="{linkTexts}">
        <f:then>
            <f:for each="{linkTexts}" as="item" iteration="iterator">
                <slub:data.fromSolr
                    query="A0001:(\"{AKA451.{iterator.index}}\")"
                    fields="id"
                    rows="10">
                <f:then>
                    <f:link.action action="detail" arguments="{id:solr.id}" class="internal">
                        {item}
                    </f:link.action>
                </f:then>
                <f:else>
                    {item}
                </f:else>
                </slub:data.fromSolr>
                <br />
            </f:for>
        </f:then>
        <f:else>
            -
        </f:else>
    </f:if>
</div>


