<f:render partial="Display/Detail/OpacLink" arguments="{_all}"/>

<div class="ctg-dtvt-row">
    <v:variable.set value="{s:data.valueForKey(array:document.fields, key:'source')}" name="source" />
    <v:variable.set value="{s:data.valueForKey(array:document.fields, key:'AUKEY')}" name="AUKEY" />

    <f:if condition="{source}=='AK' && {AUKEY}">
        <f:then>
            <div class="ctg-dtvt-label">
                Exemplar
            </div>
            <div class="ctg-dtvt-content" style="font-weight: bold;">
                Provenienz
            </div>
        </f:then>
        <f:else>

        </f:else>
    </f:if>
</div>

<v:variable.set value="{s:data.valueForKey(array:document.fields, key:'AUKEY')}" name="AUKEY" />
<v:variable.set value="{s:data.valueForKey(array:document.fields, key:'id')}" name="id" />

<f:if condition="{source}=='AK'">
    <f:then>
        <script>
            $( document ).ready(function() {
                $('.copy-details').hide();

                $('.detail_link').click(function( event ) {
                    event.preventDefault();

                    $(this).parent().parent().next('.copy-details').toggle();
                });
            });

        </script>
    </f:then>
</f:if>

<v:variable.set value="{s:data.valueForKey(array:document.fields, key:'source')}" name="source" />
<f:if condition="{source}=='BF' || {source}=='BI' || {source}=='HS' || {source}=='AK'">
    <f:then>
        <f:comment>
        <v:variable.set value="" name="aukey_query_string" />
        <f:for each="{AUKEY}" as="item" iteration="iterator">
            <f:if condition="{iterator.isFirst}">
                <f:then>
                    <v:variable.set value="{item}" name="aukey_query_string" />
                </f:then>
                <f:else>
                    <v:variable.set value="{aukey_query_string} OR {item}" name="aukey_query_string" />
                </f:else>
            </f:if>
        </f:for>

            <s:data.newArray
                    name="query"
                    global="1"
                    keys="{0:'copy_search'}"
                    values="{0:'{aukey_query_string}'}"
            />

            <dla:solveQuery array="{query}" as="solvedQuery" settings="{settings}" />
            <dla:countFromSolr query="{solvedQuery}" />
            <slub:data.fromSolr
                    query="{solvedQuery}"
                    fields="">

                <f:if condition="{solr.id}!={id}">



                </f:if>
            </slub:data.fromSolr>
        </f:comment>
        <f:if condition="{AUKEY}">
            <f:then>
                <v:variable.set value="{s:data.valueForKey(array:document.fields, key:'XX_AU_PRSTAT_AUKEY')}" name="XX_AU_PRSTAT_AUKEY" />
                <v:variable.set value="0" name="PRSTAT_FLAG" />
                <f:if condition="{XX_AU_PRSTAT_AUKEY}">
                    <f:for each="{XX_AU_PRSTAT_AUKEY}" as="PRSTAT_ITEM" iteration="item_iterator">
                        <f:if condition="{PRSTAT_ITEM}=='k'">
                            <v:variable.set value="1" name="PRSTAT_FLAG" />
                            <v:variable.set value="{item_iterator.index}" name="PRSTAT_NUMBER" />
                        </f:if>
                    </f:for>
                </f:if>
                <v:variable.set value="1" name="AUKEY_FLAG" />
                <f:for each="{AUKEY}" as="exemplar" iteration="iterator">
                    <f:if condition="{PRSTAT_FLAG} && {PRSTAT_NUMBER}!={iterator.index}">
                        <f:then>
                            <f:render partial="Display/Detail/AccessExemplar/DetailMetadata" arguments="{_all}"/>
                        </f:then>
                        <f:else>
                            <f:if condition="{PRSTAT_FLAG}==0">
                                <f:render partial="Display/Detail/AccessExemplar/DetailMetadata" arguments="{_all}"/>
                            </f:if>
                        </f:else>
                    </f:if>

                </f:for>

                <f:if condition="{PRSTAT_FLAG}">
                    <v:variable.set value="{'index':PRSTAT_NUMBER}" name="iterator" />
                    <f:render partial="Display/Detail/AccessExemplar/DetailMetadata" arguments="{_all}"/>
                </f:if>

            </f:then>
            <f:else>
                <f:render partial="Display/Detail/AccessExemplar/DetailMetadata" arguments="{_all}"/>
            </f:else>
        </f:if>
    </f:then>
    <f:else>
        Keine Exemplare vorhanden
    </f:else>
</f:if>